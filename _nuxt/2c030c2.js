(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{591:function(e,t,n){var content=n(740);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(18).default)("2393a27c",content,!0,{sourceMap:!1})},739:function(e,t,n){"use strict";n(591)},740:function(e,t,n){var o=n(17)(!1);o.push([e.i,".msg-content{height:400px;overflow-y:auto}.msg-bubble-wrap{width:100%;overflow:hidden}.msg-bubble{float:right;padding:5px 10px;min-width:20%;max-width:80%;margin:10px 15px;border:2px solid #fff}.msg-bubble.admin{float:left;background:#fff;color:#000}.msg-control{padding:0 15px}.msg-control textarea{border-radius:0;border:2px solid #fff;background:#000;color:#fff}.msg-control button{background:#fff;border-radius:0}.msg-control button.btn-outline{background:#000;color:#fff}",""]),e.exports=o},764:function(e,t,n){"use strict";n.r(t);n(22),n(1),n(3),n(54),n(38),n(43),n(69);var o={data:function(){return{message:[],form:{name:"No Name",message:"",secret:"",is_admin:0},curYear:2021,disabledSend:!1,sendCountdown:11,initSendCountdown:11}},mounted:function(){this.initialize()},methods:{initialize:function(){var e=this,t=new Date;if(this.curYear=t.getFullYear(),this.form.message="",navigator.onLine){var n=[];this.$store.dispatch("message/fetchMessage").then((function(t){t.forEach((function(e){0===e.data().is_deleted&&n.push({id:e.id,name:e.data().name,message:e.data().message,created_at:e.data().created_at,is_admin:e.data().is_admin,is_deleted:e.data().is_deleted})})),e.messageDataFormatting(n)}))}else this.messageDataFormatting([{id:"1",name:"Jhonarendra",message:"Send message not available in offline mode",created_at:"2021-11-01T21:53:00",is_admin:1,is_delete:0}]);if(localStorage.user){var o=JSON.parse(localStorage.getItem("user"));this.form.name=o.name,this.form.secret=this.$decrypt(o.secret)}},messageDataFormatting:function(e){var t=this,n=[],o=[],r="",m="",d="";e.forEach((function(e){e.time=t.$dateFormat(e.created_at,"object"),r=e.time.day,m=e.time.month,d=e.time.year;var c=r+"_"+m+"_"+d;""===r&&""===m&&""===d&&(o.push(c),n.push({id:c,day:r,month:m,year:d,data:[]})),o.includes(c)||(o.push(c),n.push({id:c,day:r,month:m,year:d,data:[]}))})),n.forEach((function(t){var data=[];e.forEach((function(e){e.time.day===t.day&&e.time.month===t.month&&e.time.year===t.year&&data.push(e)})),t.data=data})),this.message=n,this.scrollToBottom()},setName:function(){this.form.name.length>15&&(this.form.name=this.form.name.substr(15)),""===this.form.name&&(this.form.name="No Name"),"Jhonarendra"!==this.form.name&&"jhonarendra"!==this.form.name||(this.form.name="No Name",this.$bvModal.show("modalAdmin"));var e={name:this.form.name,secret:this.$decrypt(this.form.secret)};localStorage.setItem("user",JSON.stringify(e)),this.$bvModal.hide("modalProfil")},setSecret:function(){this.form.secret!==this.$decrypt("ABSBIgMBOgKIV")?(this.form.is_admin=0,this.form.name="No Name",this.form.secret=""):this.form.name="Jhonarendra";var e={name:this.form.name,secret:this.$encrypt(this.form.secret)};localStorage.setItem("user",JSON.stringify(e)),this.$bvModal.hide("modalAdmin")},sendMessage:function(e){var t=this;if(e.preventDefault(),""===this.form.message)return!1;if("Jhonarendra"===this.form.name&&this.form.secret===this.$decrypt("ABSBIgMBOgKIV")?this.form.is_admin=1:"Jhonarendra"===this.form.name&&this.form.secret!==this.$decrypt("ABSBIgMBOgKIV")?(this.form.is_admin=0,this.form.name="No Name",this.form.secret=""):"Jhonarendra"!==this.form.name&&(this.form.is_admin=0,this.form.secret=""),this.disabledSend)return!1;var n=this.fetchLocation(),o=this.getDeviceInformation(),r={name:this.form.name,message:this.form.message,is_admin:this.form.is_admin,is_deleted:0,created_at:this.$dateFormat("now","datetime"),device:n.ip_address+"|"+o.browserName+"|"+o.fullVersion+"|"+o.osName+"|lat:"+n.latitude+"|long:"+n.longitude+"|"+n.region};if(navigator.onLine)this.$store.dispatch("message/sendMessage",r).then((function(e){t.initialize(),t.setCountdown(),t.firebaseNotifReqPermission(r)}));else{var m=[];this.message.forEach((function(e){e.data.forEach((function(e){m.push({id:e.id,name:e.name,message:e.message,is_admin:e.is_admin,is_deleted:e.is_deleted,created_at:e.created_at})}))})),r.id=+new Date,m.push(r),this.messageDataFormatting(m),this.$store.commit("alertsimple/setAlertSimple",{show:!0,text:"Send message not available in offline mode",type:"danger"}),this.setCountdown()}},firebaseNotifReqPermission:function(e){var t=this;this.$fire.messaging.requestPermission().then((function(){t.$fire.messaging.getToken().then((function(n){t.setFcmToken(e,n)}))})).catch((function(n){t.fetchFcmToken(e)}))},setFcmToken:function(e,t){var n=this;this.$fire.firestore.collection("fcmtoken").get().then((function(o){var r=!1,m=[],d=[];o.forEach((function(e){e.data().token===t?r=!0:(m.push(e.data().token),d.push(e.id))})),r||n.$fire.firestore.collection("fcmtoken").add({token:t,created_at:n.$dateFormat("now","datetime")}),n.sendFirebaseNotif(e,m,d)}))},sendFirebaseNotif:function(e,t,n){var o=this;this.$store.dispatch("message/sendFirebaseNotification",{name:e.name,message:e.message,token:t}).then((function(e){var t=e.results,r=[];t.forEach((function(e,i){e.error&&r.push(n[e])})),r.length>0&&o.deleteFcmTokenUnregister(r)}))},fetchFcmToken:function(e){var t=this;this.$fire.firestore.collection("fcmtoken").get().then((function(n){var o=[],r=[];n.forEach((function(e){o.push(e.data().token),r.push(e.id)})),t.sendFirebaseNotif(e,o,r)}))},deleteFcmTokenUnregister:function(e){var t=this;e.forEach((function(e){t.$fire.firestore.collection("fcmtoken").doc(e).delete().then((function(e){console.log(e)}))}))},setCountdown:function(){var e=this;this.disabledSend=!0;for(var i=0;i<this.initSendCountdown;i++)setTimeout((function(){e.sendCountdown-=1,0===e.sendCountdown&&(e.disabledSend=!1,e.sendCountdown=e.initSendCountdown)}),1e3*i)},secondToMinute:function(s){var e="",t=0;return s>=60?(1===(t=s%60).toString().length&&(t="0"+t),e=parseInt(s/60)+":"+t):(s<60||1===s.toString().length&&(s="0"+s),e=s),e},scrollToBottom:function(){setTimeout((function(){document.getElementById("msg-content").scroll({top:document.getElementById("msg-content").scrollHeight,behavior:"smooth"})}),500)},getDeviceInformation:function(){var e,t,n,o=navigator.userAgent,r=navigator.appName,m=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10);-1!==(t=o.indexOf("Opera"))?(r="Opera",m=o.substring(t+6),-1!==(t=o.indexOf("Version"))&&(m=o.substring(t+8))):-1!==(t=o.indexOf("MSIE"))?(r="Microsoft Internet Explorer",m=o.substring(t+5)):-1!==(t=o.indexOf("Chrome"))?(r="Chrome",m=o.substring(t+7)):-1!==(t=o.indexOf("Safari"))?(r="Safari",m=o.substring(t+7),-1!==(t=o.includes("Version"))&&(m=o.substring(t+8))):-1!==(t=o.indexOf("Firefox"))?(r="Firefox",m=o.substring(t+8)):(e=o.lastIndexOf(" ")+1)<(t=o.lastIndexOf("/"))&&(r=o.substring(e,t),m=o.substring(t+1),r.toLowerCase()===r.toUpperCase()&&(r=navigator.appName)),-1!==(n=m.indexOf(";"))&&(m=m.substring(0,n)),-1!==(n=m.indexOf(" "))&&(m=m.substring(0,n)),d=parseInt(""+m,10),isNaN(d)&&(m=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10));var c="Unknown OS";return navigator.appVersion.includes("Win")&&(c="Windows"),navigator.appVersion.includes("Mac")&&(c="MacOS"),navigator.appVersion.includes("X11")&&(c="UNIX"),navigator.appVersion.includes("Linux")&&(c="Linux"),{browserName:r,fullVersion:m,majorVersion:d,appName:navigator.appName,userAgent:navigator.userAgent,osName:c}},fetchLocation:function(){return{ip_address:"-",latitude:"-",longitude:"-",region:"-"}}}},r=(n(739),n(35)),component=Object(r.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"msg-content-wrapper mt-3"},[0!==e.message.length?t("div",{staticClass:"msg-content",attrs:{id:"msg-content"}},e._l(e.message,(function(n){return t("div",{key:n.id},[t("p",{staticClass:"text-center mb-1 mt-3"},[e._v("\n        "+e._s(n.month+" "+n.day)+"\n        "+e._s(parseInt(n.year)===parseInt(e.curYear)?"":", "+n.year)+"\n      ")]),e._v(" "),e._l(n.data,(function(n){return t("div",{key:n.id,staticClass:"msg-bubble-wrap"},[t("div",{staticClass:"msg-bubble",class:n.is_admin?"admin":""},[t("p",{staticClass:"mb-1"},[t("small",[e._v(e._s(n.name))])]),e._v(" "),t("p",{staticClass:"mb-0"},[e._v("\n            "+e._s(n.message)+"\n          ")]),e._v(" "),t("p",{staticClass:"text-right mb-0"},[t("small",[e._v(e._s(n.time.hour+":"+n.time.minute))])])])])}))],2)})),0):t("div",[e._m(0)]),e._v(" "),t("hr",{staticStyle:{background:"white","border-width":"2px"}}),e._v(" "),t("div",{staticClass:"msg-control"},[t("form",{attrs:{action:"",method:""},on:{submit:e.sendMessage}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-9"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.message,expression:"form.message"}],staticClass:"form-control",attrs:{placeholder:"Message",maxlength:"100"},domProps:{value:e.form.message},on:{input:function(t){t.target.composing||e.$set(e.form,"message",t.target.value)}}}),e._v(" "),t("p",{staticClass:"text-right mb-0"},[t("small",[e._v(e._s(100-e.form.message.length))])])]),e._v(" "),t("div",{staticClass:"col-3"},[t("button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}},{name:"b-modal",rawName:"v-b-modal.modalProfil",modifiers:{modalProfil:!0}}],staticClass:"btn btn-sm btn-block btn-outline",attrs:{type:"button",title:"Change Name"}},[e._v("\n            "+e._s(e.form.name)+" "),t("i",{staticClass:"fa fa-pencil-alt pl-2"})]),e._v(" "),t("button",{staticClass:"btn btn-sm btn-block",attrs:{type:"submit",disabled:e.disabledSend}},[e._v("\n            Send "+e._s(0!==e.sendCountdown&&e.disabledSend?e.secondToMinute(e.sendCountdown):"")+"\n          ")])])])])]),e._v(" "),t("b-modal",{attrs:{id:"modalProfil","hide-header":"","hide-footer":""}},[t("label",[e._v("Name")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.name,expression:"form.name"}],staticClass:"form-control jon-form",attrs:{type:"text",maxlength:"15"},domProps:{value:e.form.name},on:{input:function(t){t.target.composing||e.$set(e.form,"name",t.target.value)}}}),e._v(" "),t("p",{staticClass:"text-right mb-0"},[t("small",[e._v(e._s(15-e.form.name.length))])]),e._v(" "),t("p",{staticClass:"text-center mb-0"},[t("a",{staticClass:"btn btn-block btn-black",on:{click:e.setName}},[e._v("OK")])])]),e._v(" "),t("b-modal",{attrs:{id:"modalAdmin","hide-footer":"","hide-header":""}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.secret,expression:"form.secret"}],staticClass:"form-control jon-form",attrs:{type:"text"},domProps:{value:e.form.secret},on:{input:function(t){t.target.composing||e.$set(e.form,"secret",t.target.value)}}}),e._v(" "),t("p",{staticClass:"text-center mt-3 mb-0"},[t("a",{staticClass:"btn btn-block btn-black",on:{click:e.setSecret}},[e._v("OK")])])])],1)}),[function(){var e=this._self._c;return e("p",{staticClass:"text-center",staticStyle:{height:"400px"}},[e("i",{staticClass:"fa fa-spinner fa-spin"})])}],!1,null,null,null);t.default=component.exports}}]);